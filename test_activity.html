<!DOCTYPE html>
<html>
<head>
    <title>Activity Feed Test</title>
</head>
<body>
    <h1>Testing Activity Feed</h1>
    <div id="currently-card" style="border: 1px solid #ccc; padding: 20px; margin: 20px;">
        <h2>Loading...</h2>
    </div>

    <script>
    class ActivityFeed {
        constructor(options = {}) {
            this.username = options.username || 'jharter1';
            this.maxItems = options.maxItems || 10;
            this.cacheKey = 'github_activity_cache';
            this.cacheDuration = options.cacheDuration || 3600000;
            this.containerId = options.containerId || 'currently-card';
            this.feedUrl = `https://github.com/${this.username}.atom`;
        }

        async init() {
            const container = document.getElementById(this.containerId);
            if (!container) {
                console.error('Container not found');
                return;
            }

            console.log('Initializing activity feed...');
            try {
                const activities = await this.fetchActivities();
                console.log('Fetched activities:', activities);
                this.renderFeed(container, activities);
            } catch (error) {
                console.error('Error initializing activity feed:', error);
                this.renderError(container);
            }
        }

        async fetchActivities() {
            console.log('Fetching from:', this.feedUrl);
            
            try {
                const response = await fetch(this.feedUrl);
                console.log('Response status:', response.status);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const text = await response.text();
                console.log('Received text length:', text.length);
                
                const activities = this.parseAtomFeed(text);
                console.log('Parsed activities:', activities.length);
                
                return activities;
            } catch (error) {
                console.error('Error fetching GitHub activity:', error);
                throw error;
            }
        }

        parseAtomFeed(xmlText) {
            const parser = new DOMParser();
            const xmlDoc = parser.parseFromString(xmlText, 'text/xml');
            const entries = xmlDoc.querySelectorAll('entry');
            
            const activities = [];
            entries.forEach((entry, index) => {
                if (index >= this.maxItems) return;
                
                const title = entry.querySelector('title')?.textContent || '';
                const link = entry.querySelector('link')?.getAttribute('href') || '';
                const published = entry.querySelector('published')?.textContent || '';
                
                activities.push({
                    platform: 'github',
                    type: 'activity',
                    title: title,
                    timestamp: published,
                    url: link
                });
            });
            
            return activities;
        }

        renderFeed(container, activities) {
            if (!activities || activities.length === 0) {
                container.innerHTML = '<h2>No activities found</h2>';
                return;
            }

            let html = '<h2>Currently - Recent GitHub Activity</h2>';
            html += '<ul>';
            activities.forEach(activity => {
                html += `<li><a href="${activity.url}" target="_blank">${activity.title}</a></li>`;
            });
            html += '</ul>';
            
            container.innerHTML = html;
        }

        renderError(container) {
            container.innerHTML = `
                <h2>Currently</h2>
                <p>Unable to load recent activity.</p>
            `;
        }
    }

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', () => {
        console.log('DOM loaded, initializing feed...');
        const activityFeed = new ActivityFeed({
            username: 'jharter1',
            maxItems: 8
        });
        
        setTimeout(() => {
            console.log('Starting init after delay...');
            activityFeed.init();
        }, 1000);
    });
    </script>
</body>
</html>
